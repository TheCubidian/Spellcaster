<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pyodide Terminal Demo</title>

<!-- 1Ô∏è‚É£ Load Pyodide from the official CDN -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>

<style>
  body {font-family: Arial, sans-serif; margin: 2rem;}
  #terminal {
    background:#111;
    color:#0f0;
    padding:1rem;
    border-radius:4px;
    white-space: pre-wrap;   /* keep line‚Äëbreaks */
    font-family: monospace;
    min-height: 200px;
    overflow:auto;
  }
</style>
</head>

<body>
<h2>üñ•Ô∏è Pyodide Terminal</h2>
<div id="terminal">(initialising‚Ä¶)</div>

<script>
/* ------------------------------------------------------------------
   2Ô∏è‚É£ Helper: capture stdout / stderr from Pyodide
   ------------------------------------------------------------------ */
function createStdoutCapture(targetElem) {
  let buffer = "";
  return {
    write: s => {
      buffer += s;
      // Update the visible terminal incrementally (nice for long runs)
      targetElem.textContent = buffer;
    },
    flush: () => {},                 // required API stub
    get: () => buffer,
    clear: () => { buffer = ""; targetElem.textContent = ""; }
  };
}

/* ------------------------------------------------------------------
   3Ô∏è‚É£ Load Pyodide once the page is ready
   ------------------------------------------------------------------ */
(async () => {
  const termDiv = document.getElementById('terminal');
  termDiv.textContent = '‚è≥ Loading Pyodide‚Ä¶';

  try {
    const pyodide = await loadPyodide({
      indexURL: "https://cdn.jsdelivr.net/pyodide/v0.26.1/full/"
    });

    // Attach our capture objects
    const stdout = createStdoutCapture(termDiv);
    pyodide.setStdout({write: stdout.write, flush: stdout.flush});
    pyodide.setStderr({write: stdout.write, flush: stdout.flush});

    termDiv.textContent = 'üöÄ Pyodide ready ‚Äì executing script‚Ä¶\n';

    /* ----------------------------------------------------------------
       4Ô∏è‚É£ The Python code you want to run automatically.
          Replace the triple‚Äëquoted string with any script you like.
       ---------------------------------------------------------------- */
    const pythonCode = `
# Example script ‚Äì replace with your own logic
import sys, math, datetime

print("=== Welcome to the Pyodide terminal ===")
print(f"Python version: {sys.version.split()[0]}")
print(f"Current UTC time: {datetime.datetime.utcnow().isoformat()}")

# Simple computation demo
def fib(n):
    a, b = 0, 1
    for _ in range(n):
        a, b = b, a + b
    return a

print("fib(20) =", fib(20))
print("sqrt(2) =", math.sqrt(2))

# You can import additional packages via pyodide.loadPackage(...)
# e.g., await pyodide.loadPackage('numpy')
`;

    // Run the script asynchronously ‚Äì any uncaught Python exception
    // will be turned into a JavaScript Error and caught below.
    await pyodide.runPythonAsync(pythonCode);

    // If the script finishes without raising, we already displayed all output.
    termDiv.textContent += "\n‚úÖ Script finished.";
  } catch (err) {
    // Show a nicely formatted traceback / JS error
    termDiv.textContent += `\n‚ùå Error:\n${err.message || err}`;
  }
})();
</script>
</body>
</html>
