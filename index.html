<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pyodide ‚Äì external script</title>
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>
<style>
  #term {background:#111;color:#0f0;padding:1rem;font-family:monospace;white-space:pre-wrap;min-height:200px;}
</style>
</head>
<body>
<h2>Pyodide ‚Äì external script demo</h2>
<div id="term">(loading‚Ä¶)</div>

<script>
(async () => {
  const term = document.getElementById('term');

  // ---------- 1Ô∏è‚É£ Load Pyodide ----------
  term.textContent = '‚è≥ Loading Pyodide‚Ä¶';
  const pyodide = await loadPyodide({
    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.26.1/full/"
  });

  // ---------- 2Ô∏è‚É£ Hook stdout / stderr ----------
  const capture = {
    buf: '',
    write(s) { this.buf += s; term.textContent = this.buf; },
    flush() {}
  };
  pyodide.setStdout(capture);
  pyodide.setStderr(capture);

  // ---------- 3Ô∏è‚É£ OPTIONAL: load extra packages ----------
  // await pyodide.loadPackage(['numpy']);   // example

  // ---------- 4Ô∏è‚É£ Fetch the external .py file ----------
  // Change the URL to wherever you host your script.
  const scriptUrl = 'spellcaster.py';   // <-- relative to this HTML file
  term.textContent = 'üì• Fetching script‚Ä¶';
  const resp = await fetch(scriptUrl);
  if (!resp.ok) throw new Error(`Failed to download ${scriptUrl}: ${resp.status}`);

  const pythonCode = await resp.text();

  // ---------- 5Ô∏è‚É£ Run the downloaded code ----------
  term.textContent = 'üöÄ Executing script‚Ä¶\n';
  try {
    await pyodide.runPythonAsync(pythonCode);
    term.textContent += '\n‚úÖ Done.';
  } catch (e) {
    term.textContent += `\n‚ùå Error:\n${e.message || e}`;
  }
})();
</script>
</body>
</html>
