<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Run Python in the Browser</title>

    <!-- Load Pyodide (the official CDN) -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>

    <style>
        body {font-family: Arial, sans-serif; margin: 2rem;}
        textarea {width: 100%; height: 150px; font-family: monospace; font-size: 1rem;}
        #output {white-space: pre-wrap; background:#f0f0f0; padding:1rem; border:1px solid #ccc;}
        button {margin-top: .5rem; padding:.5rem 1rem;}
    </style>
</head>
<body>

    <p>Click "Run" below to start Spellcaster. It is executed locally using Pyodide.</p>

    <textarea id="code">

<code>Spellcaster.py</code>

    </textarea><br/>

    <button id="runBtn">Run</button>

    <h2>Output</h2>
    <div id="output">(waiting for code…)</div>

    <script>
        // ---------------------------------------------------------
        // 1️⃣ Load Pyodide once the page is ready
        // ---------------------------------------------------------
        let pyodideReadyPromise = loadPyodide({
            indexURL : "https://cdn.jsdelivr.net/pyodide/v0.26.1/full/"
        });

        // ---------------------------------------------------------
        // 2️⃣ Helper to capture stdout / stderr from Pyodide
        // ---------------------------------------------------------
        function createStdoutCapture() {
            let output = "";
            return {
                write: (s) => { output += s; },
                flush: () => {},
                get: () => output,
                clear: () => { output = ""; }
            };
        }

        // ---------------------------------------------------------
        // 3️⃣ Run button handler
        // ---------------------------------------------------------
        document.getElementById("runBtn").addEventListener("click", async () => {
            const code = document.getElementById("code").value;
            const outDiv = document.getElementById("output");
            outDiv.textContent = "⏳ Running…";

            try {
                const pyodide = await pyodideReadyPromise;

                // Capture prints
                const stdout = createStdoutCapture();
                pyodide.setStdout({write: stdout.write});
                pyodide.setStderr({write: stdout.write});   // also capture errors

                // Execute user code
                await pyodide.runPythonAsync(code);

                // Show captured output
                outDiv.textContent = stdout.get() || "(no output)";
            } catch (err) {
                // Display Python traceback or JS error
                outDiv.textContent = "❌ Error:\n" + err;
            }
        });
    </script>
</body>
</html>
